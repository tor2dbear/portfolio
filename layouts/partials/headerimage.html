{{ .Scratch.Set "src" (.Resources.GetMatch (printf "%s*" .Params.header_image)) }}
{{ $src := .Scratch.Get "src" }}

{{/* Check file format. Originally from: https://hugomodo.github.io/blog/image-processing-and-svgs/ */}}
{{ $pathArr := split $src "." }}
{{ $pathLen := len $pathArr }}
{{ $ext := index $pathArr (sub $pathLen 1) }}

{{/* IF mp4 */}}
{{ if eq $ext "mp4" }}
  <video width="100%" height="auto" autoplay muted>
    >
    <source src="{{ $src.RelPermalink }}" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
{{ else }}
  {{ .Scratch.Set "small" ($src.Resize "500x webp") }}
  {{ .Scratch.Set "medium" ($src.Resize "800x webp") }}
  {{ .Scratch.Set "large" ($src.Resize "1200x webp") }}
  {{ .Scratch.Set "xlarge" ($src.Resize "1500x webp") }}
  {{ .Scratch.Set "fallback" ($src.Resize "1200x jpg") }}

  {{ $small := .Scratch.Get "small" }}
  {{ $medium := .Scratch.Get "medium" }}
  {{ $large := .Scratch.Get "large" }}
  {{ $xlarge := .Scratch.Get "xlarge" }}
  {{ $fallback := .Scratch.Get "fallback" }}


  <picture>
    <img
      srcset="
        {{ $small.RelPermalink }}  500w,
        {{ $medium.RelPermalink }}  800w,
        {{ $large.RelPermalink }} 1200w,
        {{ $xlarge.RelPermalink }} 1600w
      "
      alt="{{ .Title }}"
      title="{{ .Title }}"
      src="{{ $fallback.RelPermalink }}"
      height="{{ $src.Height }}"
      width="{{ $src.Width }}"
      class="img-fluid"
    />
  </picture>
{{ end }}
