{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}

<div class="settings-dropdown">
  <button
    class="settings-toggle"
    aria-label="{{ i18n "Settings" }}"
    aria-expanded="false"
    aria-haspopup="true"
    data-js="settings-toggle"
  >
    <span class="settings-icon" aria-hidden="true">
      {{ readFile "static/img/svg/cog.svg" | safeHTML }}
    </span>
  </button>

  <div class="settings-overlay" hidden data-js="settings-overlay"></div>

  <div class="settings-panel" hidden data-js="settings-panel">
    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "mode" }}</h3>
      <div class="theme-options">
        <button
          class="theme-option"
          data-mode="light"
          data-js="mode-option"
          aria-label="{{ i18n "light_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="/img/svg/sprite.svg#icon-light"></use>
          </svg>
          <span>{{ i18n "light_mode" }}</span>
        </button>

        <button
          class="theme-option"
          data-mode="dark"
          data-js="mode-option"
          aria-label="{{ i18n "dark_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="/img/svg/sprite.svg#icon-dark"></use>
          </svg>
          <span>{{ i18n "dark_mode" }}</span>
        </button>

        <button
          class="theme-option"
          data-mode="system"
          data-js="mode-option"
          aria-label="{{ i18n "system_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="/img/svg/sprite.svg#icon-system"></use>
          </svg>
          <span>{{ i18n "system_mode" }}</span>
        </button>
      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "palette" }}</h3>
      <div class="theme-options theme-options--palette">
        <button
          class="theme-option theme-option--palette"
          data-palette="standard"
          data-js="palette-option"
          aria-label="Standard"
        >
          <span class="palette-preview palette-preview--standard">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Standard</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="pantone"
          data-js="palette-option"
          aria-label="Pantone"
        >
          <span class="palette-preview palette-preview--pantone">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Pantone</span>
        </button>
      </div>
    </div>

    {{- if gt $languageCount 1 -}}
    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "lang_select_title" }}</h3>
      <div class="language-list">
        {{- range .Translations -}}
          <a
            href="{{ .RelPermalink }}"
            class="language-option"
            lang="{{ .Language.Lang }}"
            hreflang="{{ .Language.Lang }}"
          >
            <span class="language-radio" aria-hidden="true"></span>
            <span class="language-name">{{ .Language.LanguageName }}</span>
          </a>
        {{- end -}}

        <span class="language-option language-option--current" aria-current="true">
          <span class="language-radio" aria-hidden="true"></span>
          <span class="language-name">{{ .Language.LanguageName }}</span>
        </span>

        {{- if eq (len $translations) 0 -}}
          {{- range $.Site.Languages -}}
            {{- if ne .Lang $.Language.Lang -}}
              <a
                href="{{ "/" | relLangURL . }}"
                class="language-option language-option--fallback"
                lang="{{ .Lang }}"
                hreflang="{{ .Lang }}"
                title="{{ i18n "also_on_homepage" }}"
              >
                <span class="language-radio" aria-hidden="true"></span>
                <span class="language-name">{{ .LanguageName }}</span>
                <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
              </a>
            {{- end -}}
          {{- end -}}
        {{- end -}}
      </div>
    </div>
    {{- end -}}
  </div>
</div>
