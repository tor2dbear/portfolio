{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}

<div class="settings-dropdown">
  <button
    class="settings-toggle"
    aria-label="{{ i18n "Settings" }}"
    aria-expanded="false"
    aria-haspopup="true"
    data-js="settings-toggle"
  >
    <span class="settings-icon" aria-hidden="true">
      <svg class="icon" aria-hidden="true">
        <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-settings"></use>
      </svg>
    </span>
  </button>

  <div class="settings-overlay" hidden data-js="settings-overlay"></div>

  <div class="settings-panel" hidden data-js="settings-panel">
    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "mode" }}</h3>
      <div class="theme-options">
        <button
          class="theme-option"
          data-mode="light"
          data-js="mode-option"
          aria-label="{{ i18n "light_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-light"></use>
          </svg>
          <span>{{ i18n "light_mode" }}</span>
        </button>

        <button
          class="theme-option"
          data-mode="dark"
          data-js="mode-option"
          aria-label="{{ i18n "dark_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-dark"></use>
          </svg>
          <span>{{ i18n "dark_mode" }}</span>
        </button>

        <button
          class="theme-option"
          data-mode="system"
          data-js="mode-option"
          aria-label="{{ i18n "system_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-system"></use>
          </svg>
          <span>{{ i18n "system_mode" }}</span>
        </button>
      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "palette" }}</h3>
      <div class="theme-options theme-options--palette">
        <button
          class="theme-option theme-option--palette"
          data-palette="standard"
          data-js="palette-option"
          aria-label="Standard"
        >
          <span class="palette-preview palette-preview--standard">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Standard</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="forest"
          data-js="palette-option"
          aria-label="Forest"
        >
          <span class="palette-preview palette-preview--forest">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Forest</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="mesa"
          data-js="palette-option"
          aria-label="Mesa"
        >
          <span class="palette-preview palette-preview--mesa">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Mesa</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="pantone"
          data-js="palette-option"
          aria-label="{{ i18n "palette_pantone" }}"
        >
          <span class="palette-preview palette-preview--pantone">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">{{ i18n "palette_pantone" }}</span>
        </button>

      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "typography" }}</h3>
      <div class="theme-options theme-options--typography">
        <button
          class="theme-option theme-option--typography"
          data-typography="editorial"
          data-js="typography-option"
          aria-label="Editorial"
        >
          <span class="typography-preview">Aa</span>
          <span class="typography-label">Editorial</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="refined"
          data-js="typography-option"
          aria-label="Refined"
        >
          <span class="typography-preview typography-preview--refined">Aa</span>
          <span class="typography-label">Refined</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="expressive"
          data-js="typography-option"
          aria-label="Expressive"
        >
          <span class="typography-preview typography-preview--expressive">Aa</span>
          <span class="typography-label">Expressive</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="technical"
          data-js="typography-option"
          aria-label="Technical"
        >
          <span class="typography-preview typography-preview--technical">Aa</span>
          <span class="typography-label">Technical</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="system"
          data-js="typography-option"
          aria-label="System"
        >
          <span class="typography-preview typography-preview--system">Aa</span>
          <span class="typography-label">System</span>
        </button>
      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">Grid</h3>
      <button
        class="toggle-switch"
        data-js="grid-toggle"
        data-toast-title="{{ i18n "toast_grid_title" }}"
        data-toast-on="{{ i18n "toast_grid_on" }}"
        data-toast-off="{{ i18n "toast_grid_off" }}"
        role="switch"
        aria-pressed="false"
        aria-label="Toggle grid overlay"
      >
        <span class="toggle-switch__track">
          <span class="toggle-switch__thumb"></span>
        </span>
        <span class="toggle-switch__label">Show grid</span>
        <span class="toggle-switch__shortcut">Ctrl+G</span>
      </button>
    </div>

    {{- if gt $languageCount 1 -}}
    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "lang_select_title" }}</h3>
      <div class="language-list">
        {{- range .Translations -}}
          <a
            href="{{ .RelPermalink }}"
            class="language-option"
            lang="{{ .Language.Lang }}"
            hreflang="{{ .Language.Lang }}"
          >
            <span class="language-radio" aria-hidden="true"></span>
            <span class="language-name">{{ .Language.LanguageName }}</span>
          </a>
        {{- end -}}

        <span class="language-option language-option--current" aria-current="true">
          <span class="language-radio" aria-hidden="true"></span>
          <span class="language-name">{{ .Language.LanguageName }}</span>
        </span>

        {{- if eq (len $translations) 0 -}}
          {{- range $.Site.Languages -}}
            {{- if ne .Lang $.Language.Lang -}}
              <a
                href="{{ "/" | relLangURL . }}"
                class="language-option language-option--fallback"
                lang="{{ .Lang }}"
                hreflang="{{ .Lang }}"
                title="{{ i18n "also_on_homepage" }}"
              >
                <span class="language-radio" aria-hidden="true"></span>
                <span class="language-name">{{ .LanguageName }}</span>
                <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
              </a>
            {{- end -}}
          {{- end -}}
        {{- end -}}
      </div>
    </div>
    {{- end -}}
  </div>
</div>
