{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}
{{- $translationsByLang := dict -}}
{{- range $translations -}}
  {{- $translationsByLang = merge $translationsByLang (dict .Language.Lang .) -}}
{{- end -}}

<div class="settings-dropdown">
  <button
    class="settings-toggle"
    aria-label="{{ i18n "Settings" }}"
    aria-expanded="false"
    aria-haspopup="true"
    data-js="settings-toggle"
  >
    <span class="settings-icon" aria-hidden="true">
      <svg class="icon" aria-hidden="true">
        <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-settings"></use>
      </svg>
    </span>
  </button>

  <div class="settings-overlay" hidden data-js="settings-overlay"></div>

  <div class="settings-panel" hidden data-js="settings-panel">
    <div class="theme-section">
      <h3 class="theme-section-title">{{ i18n "mode" }}</h3>
      <div class="theme-options">
        <button
          class="theme-option"
          data-mode="light"
          data-js="mode-option"
          aria-label="{{ i18n "light_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-light"></use>
          </svg>
          <span>{{ i18n "light_mode" }}</span>
          <span class="toggle-switch__shortcut" data-shortcut="T L">T L</span>
        </button>

        <button
          class="theme-option"
          data-mode="dark"
          data-js="mode-option"
          aria-label="{{ i18n "dark_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-dark"></use>
          </svg>
          <span>{{ i18n "dark_mode" }}</span>
          <span class="toggle-switch__shortcut" data-shortcut="T D">T D</span>
        </button>

        <button
          class="theme-option"
          data-mode="system"
          data-js="mode-option"
          aria-label="{{ i18n "system_mode" }}"
        >
          <svg class="theme-option-icon" width="20" height="20" aria-hidden="true">
            <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-system"></use>
          </svg>
          <span>{{ i18n "system_mode" }}</span>
          <span class="toggle-switch__shortcut" data-shortcut="T S">T S</span>
        </button>
      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <div class="theme-section-heading">
        <h3 class="theme-section-title">{{ i18n "palette" }}</h3>
        <span class="toggle-switch__shortcut" data-shortcut="P 1-4">P 1-4</span>
      </div>
      <div class="theme-options theme-options--palette">
        <button
          class="theme-option theme-option--palette"
          data-palette="standard"
          data-js="palette-option"
          aria-label="Standard"
        >
          <span class="palette-preview palette-preview--standard">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Standard</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="forest"
          data-js="palette-option"
          aria-label="Forest"
        >
          <span class="palette-preview palette-preview--forest">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Forest</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="mesa"
          data-js="palette-option"
          aria-label="Mesa"
        >
          <span class="palette-preview palette-preview--mesa">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">Mesa</span>
        </button>

        <button
          class="theme-option theme-option--palette"
          data-palette="pantone"
          data-js="palette-option"
          aria-label="{{ i18n "palette_pantone" }}"
        >
          <span class="palette-preview palette-preview--pantone">
            <span class="palette-preview-segment"></span>
            <span class="palette-preview-segment"></span>
          </span>
          <span class="palette-label">{{ i18n "palette_pantone" }}</span>
        </button>

      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <div class="theme-section-heading">
        <h3 class="theme-section-title">{{ i18n "typography" }}</h3>
        <span class="toggle-switch__shortcut" data-shortcut="F 1-4">F 1-4</span>
      </div>
      <div class="theme-options theme-options--typography">
        <button
          class="theme-option theme-option--typography"
          data-typography="editorial"
          data-js="typography-option"
          aria-label="Editorial"
        >
          <span class="typography-preview">Aa</span>
          <span class="typography-label">Editorial</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="refined"
          data-js="typography-option"
          aria-label="Refined"
        >
          <span class="typography-preview typography-preview--refined">Aa</span>
          <span class="typography-label">Refined</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="expressive"
          data-js="typography-option"
          aria-label="Expressive"
        >
          <span class="typography-preview typography-preview--expressive">Aa</span>
          <span class="typography-label">Expressive</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="technical"
          data-js="typography-option"
          aria-label="Technical"
        >
          <span class="typography-preview typography-preview--technical">Aa</span>
          <span class="typography-label">Technical</span>
        </button>

        <button
          class="theme-option theme-option--typography"
          data-typography="system"
          data-js="typography-option"
          aria-label="System"
        >
          <span class="typography-preview typography-preview--system">Aa</span>
          <span class="typography-label">System</span>
        </button>
      </div>
    </div>

    <div class="theme-divider"></div>

    <div class="theme-section">
      <h3 class="theme-section-title">Grid</h3>
      <button
        class="toggle-switch"
        data-js="grid-toggle"
        data-toast-title="{{ i18n "toast_grid_title" }}"
        data-toast-on="{{ i18n "toast_grid_on" }}"
        data-toast-off="{{ i18n "toast_grid_off" }}"
        role="switch"
        aria-pressed="false"
        aria-label="Toggle grid overlay"
      >
        <span class="toggle-switch__track">
          <span class="toggle-switch__thumb"></span>
        </span>
        <span class="toggle-switch__label">Show grid</span>
        <span class="toggle-switch__shortcut" data-shortcut="G">G</span>
      </button>
    </div>

    {{- if gt $languageCount 1 -}}
    <div class="theme-divider"></div>

    <div class="theme-section">
      <div class="theme-section-heading">
        <h3 class="theme-section-title">{{ i18n "lang_select_title" }}</h3>
      </div>
      <div class="language-list" role="radiogroup" aria-label="{{ i18n "lang_select_title" }}">
        {{- range $.Site.Languages -}}
          {{- $isCurrent := eq .Lang $.Language.Lang -}}
          {{- $target := index $translationsByLang .Lang -}}
          {{- if $isCurrent -}}
            <label class="language-option radio language-option--current" lang="{{ .Lang }}">
              <input
                type="radio"
                name="language-selector-settings"
                value="{{ .Lang }}"
                data-language-code="{{ .Lang }}"
                data-language-name="{{ .LanguageName }}"
                checked
                aria-current="true"
              >
              <span class="radio__visual" aria-hidden="true"></span>
              <span class="radio__label language-name">{{ .LanguageName }}</span>
              {{- if eq .Lang "en" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L E">L E</span>{{- end -}}
              {{- if eq .Lang "sv" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L S">L S</span>{{- end -}}
            </label>
          {{- else if $target -}}
            <label class="language-option radio" lang="{{ .Lang }}" data-language-href="{{ $target.RelPermalink }}">
              <input
                type="radio"
                name="language-selector-settings"
                value="{{ .Lang }}"
                data-language-code="{{ .Lang }}"
                data-language-name="{{ .LanguageName }}"
                data-language-href="{{ $target.RelPermalink }}"
              >
              <span class="radio__visual" aria-hidden="true"></span>
              <span class="radio__label language-name">{{ .LanguageName }}</span>
              {{- if eq .Lang "en" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L E">L E</span>{{- end -}}
              {{- if eq .Lang "sv" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L S">L S</span>{{- end -}}
            </label>
          {{- else -}}
            <label
              class="language-option radio language-option--fallback"
              lang="{{ .Lang }}"
              title="{{ i18n "also_on_homepage" }}"
              data-language-href="{{ "/" | relLangURL . }}"
            >
              <input
                type="radio"
                name="language-selector-settings"
                value="{{ .Lang }}"
                data-language-code="{{ .Lang }}"
                data-language-name="{{ .LanguageName }}"
                data-language-href="{{ "/" | relLangURL . }}"
              >
              <span class="radio__visual" aria-hidden="true"></span>
              <span class="radio__label language-name">{{ .LanguageName }}</span>
              <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
            </label>
          {{- end -}}
        {{- end -}}
      </div>
    </div>
    {{- end -}}
  </div>
</div>
