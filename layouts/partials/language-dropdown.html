{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}

{{- if gt $languageCount 1 -}}
<div class="language-dropdown">
  <button
    class="language-toggle"
    aria-label="{{ i18n "lang_select_title" }}"
    aria-expanded="false"
    aria-haspopup="true"
  >
    <svg class="language-icon" aria-hidden="true" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
      <g transform="scale(.66666)" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
        <polyline points="19.652 .748 15.902 2.998 18.152 6.748"></polyline>
        <path d="M23.25 8.187v0c-1.04-2.86-3.86-4.67-6.884-4.42"></path>
        <polyline points="4.348 23.248 8.098 20.998 5.848 17.248"></polyline>
        <path d="M.75 15.808H.749c1.03 2.85 3.85 4.66 6.88 4.41"></path>
        <rect width="12" height="12" x=".75" y=".748" rx="1.5"></rect>
        <path d="M15.75 11.24h6v0c.82 0 1.5.67 1.5 1.5v9 0c0 .82-.68 1.5-1.5 1.5h-9v0c-.83 0-1.5-.68-1.5-1.5v-6"></path>
        <path d="M15.75 20.24v-4.5 0c0-.83.67-1.5 1.5-1.5 .82 0 1.5.67 1.5 1.5v4.5"></path>
        <line x1="15.75" x2="18.75" y1="18.75" y2="18.75"></line>
        <line x1="6.75" x2="6.75" y1="3.75" y2="5.25"></line>
        <line x1="3.75" x2="9.75" y1="5.25" y2="5.25"></line>
        <path d="M8.25 5.248s-1.5 4.5-4.5 4.5"></path>
        <path d="M6.74 8.014l-.001-.001c.67 1.01 1.78 1.65 3 1.73"></path>
      </g>
    </svg>
  </button>

  <div class="language-panel" hidden>
    <div class="language-list">
      {{- range .Translations -}}
        <a
          href="{{ .RelPermalink }}"
          class="language-option"
          lang="{{ .Language.Lang }}"
          hreflang="{{ .Language.Lang }}"
        >
          <span class="language-radio" aria-hidden="true"></span>
          <span class="language-name">{{ .Language.LanguageName }}</span>
        </a>
      {{- end -}}

      {{- /* Current language (shown but not clickable) */ -}}
      <span class="language-option language-option--current" aria-current="true">
        <span class="language-radio" aria-hidden="true"></span>
        <span class="language-name">{{ .Language.LanguageName }}</span>
      </span>

      {{- /* Fallback languages - shown only if current page has no translation */ -}}
      {{- if eq (len $translations) 0 -}}
        {{- range $.Site.Languages -}}
          {{- if ne .Lang $.Language.Lang -}}
            <a
              href="{{ "/" | relLangURL . }}"
              class="language-option language-option--fallback"
              lang="{{ .Lang }}"
              hreflang="{{ .Lang }}"
              title="{{ i18n "also_on_homepage" }}"
            >
              <span class="language-radio" aria-hidden="true"></span>
              <span class="language-name">{{ .LanguageName }}</span>
              <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
            </a>
          {{- end -}}
        {{- end -}}
      {{- end -}}
    </div>
  </div>
</div>
{{- end -}}
