{{- $translations := .Translations -}}
{{- if gt (len $translations) 0 -}}
{{- $translationsByLang := dict -}}
{{- range $translations -}}
  {{- $translationsByLang = merge $translationsByLang (dict .Language.Lang .) -}}
{{- end -}}
<div class="language-dropdown">
  <button
    class="language-toggle"
    aria-label="{{ i18n "lang_select_title" }}"
    aria-expanded="false"
    aria-haspopup="true"
  >
    <div class="language-icon">
      <svg width="20" height="20" aria-hidden="true">
        <use href="{{ "/img/svg/sprite.svg?v=20260211b" | relURL }}#icon-language"></use>
      </svg>
    </div>
  </button>

  <div class="language-panel" hidden>
    <div class="language-list" role="radiogroup" aria-label="{{ i18n "lang_select_title" }}">
      {{- range $.Site.Languages -}}
        {{- $isCurrent := eq .Lang $.Language.Lang -}}
        {{- $target := index $translationsByLang .Lang -}}
        {{- if or $isCurrent $target -}}
          <label
            class="language-option radio{{ if $isCurrent }} language-option--current{{ end }}"
            lang="{{ .Lang }}"
            {{- if not $isCurrent }} data-language-href="{{ $target.RelPermalink }}"{{ end -}}
          >
            <input
              type="radio"
              name="language-selector-desktop"
              value="{{ .Lang }}"
              data-language-code="{{ .Lang }}"
              data-language-name="{{ .LanguageName }}"
              {{- if not $isCurrent }} data-language-href="{{ $target.RelPermalink }}"{{ end -}}
              {{- if $isCurrent }} checked aria-current="true"{{ end -}}
            >
            <span class="radio__visual" aria-hidden="true"></span>
            <span class="radio__label language-name">{{ .LanguageName }}</span>
            {{- if eq .Lang "en" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L E">L E</span>{{- end -}}
            {{- if eq .Lang "sv" -}}<span class="toggle-switch__shortcut language-option__shortcut" data-shortcut="L S">L S</span>{{- end -}}
          </label>
        {{- end -}}
      {{- end -}}
    </div>
  </div>
  <div class="language-overlay" hidden></div>
</div>
{{- end -}}
