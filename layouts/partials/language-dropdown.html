{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}

{{- if gt $languageCount 1 -}}
<div class="language-dropdown">
  <button
    class="language-toggle"
    aria-label="{{ i18n "lang_select_title" }}"
    aria-expanded="false"
    aria-haspopup="true"
  >
    <span class="current-language">{{ .Language.LanguageName }}</span>
    <span class="language-code">{{ upper .Language.Lang }}</span>
    <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="language-panel" hidden>
    <div class="language-list">
      {{- range .Translations -}}
        <a
          href="{{ .RelPermalink }}"
          class="language-option"
          lang="{{ .Language.Lang }}"
          hreflang="{{ .Language.Lang }}"
        >
          <span class="language-flag" aria-hidden="true">
            {{- if eq .Language.Lang "en" -}}
              ðŸ‡¬ðŸ‡§
            {{- else if eq .Language.Lang "sv" -}}
              ðŸ‡¸ðŸ‡ª
            {{- end -}}
          </span>
          <span class="language-name">{{ .Language.LanguageName }}</span>
        </a>
      {{- end -}}

      {{- /* Current language (shown but not clickable) */ -}}
      <span class="language-option language-option--current" aria-current="true">
        <span class="language-flag" aria-hidden="true">
          {{- if eq .Language.Lang "en" -}}
            ðŸ‡¬ðŸ‡§
          {{- else if eq .Language.Lang "sv" -}}
            ðŸ‡¸ðŸ‡ª
          {{- end -}}
        </span>
        <span class="language-name">{{ .Language.LanguageName }}</span>
        <svg class="check-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 8L6.5 11.5L13 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>

      {{- /* Fallback languages - shown only if current page has no translation */ -}}
      {{- if eq (len $translations) 0 -}}
        {{- range $.Site.Languages -}}
          {{- if ne .Lang $.Language.Lang -}}
            <a
              href="{{ "/" | relLangURL . }}"
              class="language-option language-option--fallback"
              lang="{{ .Lang }}"
              hreflang="{{ .Lang }}"
              title="{{ i18n "also_on_homepage" }}"
            >
              <span class="language-flag" aria-hidden="true">
                {{- if eq .Lang "en" -}}
                  ðŸ‡¬ðŸ‡§
                {{- else if eq .Lang "sv" -}}
                  ðŸ‡¸ðŸ‡ª
                {{- end -}}
              </span>
              <span class="language-name">{{ .LanguageName }}</span>
              <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
            </a>
          {{- end -}}
        {{- end -}}
      {{- end -}}
    </div>
  </div>
</div>
{{- end -}}
