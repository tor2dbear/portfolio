{{- $translations := .Translations -}}
{{- $languageCount := add (len $translations) 1 -}}

{{- if gt $languageCount 1 -}}
<div class="language-dropdown">
  <button
    class="language-toggle"
    aria-label="{{ i18n "lang_select_title" }}"
    aria-expanded="false"
    aria-haspopup="true"
  >
    <div class="language-icon">
      <svg aria-hidden="true">
        <use href="/img/svg/sprite.svg#icon-language"></use>
      </svg>
    </div>
  </button>

  <div class="language-panel" hidden>
    <div class="language-list">
      {{- range .Translations -}}
        <a
          href="{{ .RelPermalink }}"
          class="language-option"
          lang="{{ .Language.Lang }}"
          hreflang="{{ .Language.Lang }}"
        >
          <span class="language-radio" aria-hidden="true"></span>
          <span class="language-name">{{ .Language.LanguageName }}</span>
        </a>
      {{- end -}}

      {{- /* Current language (shown but not clickable) */ -}}
      <span class="language-option language-option--current" aria-current="true">
        <span class="language-radio" aria-hidden="true"></span>
        <span class="language-name">{{ .Language.LanguageName }}</span>
      </span>

      {{- /* Fallback languages - shown only if current page has no translation */ -}}
      {{- if eq (len $translations) 0 -}}
        {{- range $.Site.Languages -}}
          {{- if ne .Lang $.Language.Lang -}}
            <a
              href="{{ "/" | relLangURL . }}"
              class="language-option language-option--fallback"
              lang="{{ .Lang }}"
              hreflang="{{ .Lang }}"
              title="{{ i18n "also_on_homepage" }}"
            >
              <span class="language-radio" aria-hidden="true"></span>
              <span class="language-name">{{ .LanguageName }}</span>
              <span class="fallback-indicator">{{ i18n "to_homepage" }}</span>
            </a>
          {{- end -}}
        {{- end -}}
      {{- end -}}
    </div>
  </div>
  <div class="language-overlay" hidden></div>
</div>
{{- end -}}
